(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{459:function(t,v,_){"use strict";_.r(v);var a=_(9),e=Object(a.a)({},(function(){var t=this,v=t.$createElement,_=t._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"ospf笔记"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#ospf笔记"}},[t._v("#")]),t._v(" OSPF笔记")]),t._v(" "),_("h1",{attrs:{id:"_1-ospfv2简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-ospfv2简介"}},[t._v("#")]),t._v(" 1. OSPFv2简介")]),t._v(" "),_("h2",{attrs:{id:"_1-1-ospf的诞生"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-ospf的诞生"}},[t._v("#")]),t._v(" 1.1 OSPF的诞生")]),t._v(" "),_("p",[t._v("OSPF这种链路状态协议主要为了解决"),_("code",[t._v("动态路由协议RIP只适合小型网络")]),t._v("而提出的。")]),t._v(" "),_("p",[t._v("提出OSPF的主要原因如下：")]),t._v(" "),_("ol",[_("li",[_("p",[t._v("动态路由协议中的RIP协议，它最大跳数只能是"),_("code",[t._v("16")]),t._v("跳,这只适用于小型网络；")])]),t._v(" "),_("li",[_("p",[t._v("RIP的等距离矢量路由协议会产生"),_("code",[t._v("次优路径")]),t._v("问题，这是由于距离矢量协议的"),_("code",[t._v("Metric")]),t._v("值没有计算链路带宽；")]),t._v(" "),_("blockquote",[_("p",[_("strong",[t._v("次优路径问题")]),t._v("：")]),t._v(" "),_("p",[t._v("简单来说，就是A到B两点间，有多条路径，但是根据路由协议算出来的最优路径，实际上并不是最优路径。")]),t._v(" "),_("p",[t._v("因为两点之间的链路开销，有许多的属性可以衡量，而如果一个路由协议Metric值的计算方法越优秀，那么他产生次优路径问题的情况就会越少。")])])]),t._v(" "),_("li",[_("p",[t._v("距离矢量路由协议收敛速度较慢；（RIP每30s更新路由信息给邻居）")])])]),t._v(" "),_("h2",{attrs:{id:"_1-2-ospf-简介"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-ospf-简介"}},[t._v("#")]),t._v(" 1.2 OSPF 简介")]),t._v(" "),_("ol",[_("li",[t._v("OSPF（Open Shortest Path Frist，开放最短路径优先协议），是一种"),_("code",[t._v("链路状态")]),t._v("路由协议(Link-state routing Protocol), 版本2是"),_("code",[t._v("IPV4")]),t._v("使用的；")])]),t._v(" "),_("blockquote",[_("p",[_("code",[t._v("距离路由矢量")]),t._v("协议和"),_("code",[t._v("链路状态")]),t._v("协议的区别：")]),t._v(" "),_("ol",[_("li",[t._v("运行距离矢量路由协议（distance-vector routing protocol）的路由器会在接口上"),_("code",[t._v("周期性")]),t._v("泛洪自己的路由表，即路由更新消息中有路由信息。(链路状态路由协议交换的是"),_("code",[t._v("链路状态LSA")]),t._v("而不是路由信息)；")]),t._v(" "),_("li",[t._v("路由器无法知道整网拓扑结构，只能通过路由更新来学习路由这种方式被称为依照传闻更新；（启用链路状态路由协议的每个路由器都能够知道"),_("code",[t._v("整网")]),t._v("的拓扑结构）；")]),t._v(" "),_("li",[t._v("链路状态协议相比于距离矢量协议的"),_("code",[t._v("收敛速度更快")]),t._v("，可以支持更大型的网络。")])])]),t._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[t._v("OSPF是一个"),_("code",[t._v("IGP")]),t._v("（Interior Gateway Protocol，内部网关协议）协议；")])]),t._v(" "),_("blockquote",[_("p",[t._v("IGP内部网关协议是指：在一个"),_("code",[t._v("自治系统AS")]),t._v("内部所使用的路由协议。")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.bluebaozi.cn/img/image-20210617155301338-1623916389391-20210710165335664.png",alt:"image-IGP路由分类"}})]),t._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[t._v("OSPF使用Dijkstra("),_("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E6%88%B4%E5%85%8B%E6%96%AF%E7%89%B9%E6%8B%89%E7%AE%97%E6%B3%95",target:"_blank",rel:"noopener noreferrer"}},[t._v("戴克斯特拉算法"),_("OutboundLink")],1),t._v(")的最短路径优先算法SPF，来找到最优路径；")])]),t._v(" "),_("blockquote",[_("p",[t._v("Dijkstra算法是采用类似于"),_("code",[t._v("广度优先")]),t._v("的算法来解决"),_("code",[t._v("赋权图")]),t._v("的"),_("code",[t._v("单源最短路径")]),t._v("问题，从算法角度简单来说，就在数据结构的"),_("code",[t._v("图")]),t._v("中找到最短路径的"),_("code",[t._v("树")]),t._v("。")])]),t._v(" "),_("ol",{attrs:{start:"4"}},[_("li",[_("p",[t._v("OSPFv1用于实验室，OSPFv2广泛用于ipv4（"),_("a",{attrs:{href:"https://tools.ietf.org/html/rfc2328",target:"_blank",rel:"noopener noreferrer"}},[t._v("RFC 2328"),_("OutboundLink")],1),t._v("），而OSPFv3则支持了ipv6("),_("a",{attrs:{href:"https://tools.ietf.org/html/rfc5340",target:"_blank",rel:"noopener noreferrer"}},[t._v("RFC 5340"),_("OutboundLink")],1),t._v(")；")])]),t._v(" "),_("li",[_("p",[t._v("OSPF提出区域Area的概念；")])])]),t._v(" "),_("blockquote",[_("p",[t._v("一个OSPF网络可以由"),_("code",[t._v("单一")]),t._v("区域或者"),_("code",[t._v("多个")]),t._v("区域组成;")]),t._v(" "),_("ol",[_("li",[_("p",[_("code",[t._v("骨干区域")]),t._v("是一个特殊区域，他和所有其他区域直接相连，任意两个区域之间需要传递路由，必须通过骨干区域；")])]),t._v(" "),_("li",[_("p",[t._v("如果其他区域不能和骨干区域直接相连，需要创建"),_("code",[t._v("virtual link（虚链路）")]),t._v("来创建和骨干区域的虚拟链接；")])]),t._v(" "),_("li",[_("p",[t._v("每个路由器上同一个区域的"),_("code",[t._v("LSDB（链路状态数据库）")]),t._v("是一致的，属于多个区域的路由器会在每个区域独立得维护一份LSDB；")])]),t._v(" "),_("li",[_("p",[t._v("多区域的设计让OSPF能够支持更大规模的网络；")])])])]),t._v(" "),_("ol",{attrs:{start:"6"}},[_("li",[t._v("OSPF运行在IP协议之上，IP协议号是"),_("code",[t._v("89")]),t._v(";")])]),t._v(" "),_("blockquote",[_("p",[t._v("OSPF不运行在TCP或者UDP协议之上，而是直接承载在IP协议之上。")])]),t._v(" "),_("ol",{attrs:{start:"7"}},[_("li",[t._v("OSPF同时使用"),_("code",[t._v("单播")]),t._v("和"),_("code",[t._v("组播")]),t._v("发送Hello包和链路状态更新，并且OSPF是"),_("code",[t._v("触发更新")]),t._v("；")])]),t._v(" "),_("blockquote",[_("p",[t._v("组播地址："),_("code",[t._v("224.0.0.5")]),t._v("和"),_("code",[t._v("224.0.0.6")])]),t._v(" "),_("p",[t._v("触发更新： 即检测到自己链路状态发生变化后，才主动发出链路状态LSA信息通告给邻居，节省了带宽；")])]),t._v(" "),_("ol",{attrs:{start:"8"}},[_("li",[t._v("OSPF的管理距离是"),_("code",[t._v("110")]),t._v("；")])]),t._v(" "),_("blockquote",[_("p",[_("strong",[t._v("管理距离")]),t._v("：")]),t._v(" "),_("p",[t._v("由于单个路由器可能运行多种路由协议，那么可能到达同一目的地会有"),_("code",[t._v("多条")]),t._v("不同路由协议产生的"),_("code",[t._v("路由")]),t._v("，那么路由器就需要选择最佳路径路由。")]),t._v(" "),_("p",[t._v("对不同协议的产生的路由，不同路由协议的"),_("code",[t._v("管理距离")]),t._v("定义了路由的"),_("code",[t._v("可靠性（优先级）")]),t._v("，管理距离值越大，优先级越低。")]),t._v(" "),_("p",[t._v("每个路由协议都有自己的"),_("code",[t._v("默认管理距离")]),t._v("，可以Google查询一下。")])]),t._v(" "),_("ol",{attrs:{start:"9"}},[_("li",[t._v("支持VLSM(可以无类别地处理IP地址)和手工路由汇总；")])]),t._v(" "),_("blockquote",[_("p",[_("strong",[t._v("VLSM(Variable-Length Subnet Masks)")])]),t._v(" "),_("p",[t._v("可变长子网掩码，通过先去去欸的确定所需IP数量，在确定网络掩码，提高IP利用效率。")]),t._v(" "),_("p",[t._v("比如一个28位掩码的子网，可用IP数为2^(32-28)-2 = 14个IP地址（减去的"),_("code",[t._v("2")]),t._v("是网络的"),_("code",[t._v("广播地址")]),t._v("和"),_("code",[t._v("网络地址")]),t._v("）")])]),t._v(" "),_("h2",{attrs:{id:"_1-3-ospf-基础概念"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ospf-基础概念"}},[t._v("#")]),t._v(" 1.3 OSPF 基础概念")]),t._v(" "),_("h3",{attrs:{id:"_1-3-1-ospf-router-id"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-ospf-router-id"}},[t._v("#")]),t._v(" 1.3.1 OSPF Router-ID")]),t._v(" "),_("ol",[_("li",[_("p",[t._v("Router Identifier:路由标识符，可以"),_("code",[t._v("唯一")]),t._v("标识一台路由器,所以一个路由器只能有一个OSPF的RID；")])]),t._v(" "),_("li",[_("p",[t._v("Router ID可以通过手工设定，也可以自动获取；")]),t._v(" "),_("blockquote",[_("p",[t._v("RID自动设定规则：")]),t._v(" "),_("ol",[_("li",[_("p",[t._v("RID设定遵循"),_("code",[t._v("稳定第一")]),t._v("的规则；")])]),t._v(" "),_("li",[_("p",[t._v("如有loopback接口，那么选择loopback接口中"),_("code",[t._v("IP地址最大")]),t._v("的为RID，没有loopback接口，则选择"),_("code",[t._v("UP")]),t._v("状态的接口中"),_("code",[t._v("IP地址最大")]),t._v("的作为RID（RID为IP地址）（无论接口是否在OSPF域中都可以参与RID的选择）；")])]),t._v(" "),_("li",[_("p",[t._v("推荐使用环回口或者手工指定RID，确定RID后，如果邻居关系建立之后，那么只有"),_("code",[t._v("重启")]),t._v("OSPF进程才能修改RID；")])])])])]),t._v(" "),_("li",[_("p",[t._v("RID协议写成"),_("code",[t._v("点分十进制")]),t._v("的模式,，即"),_("code",[t._v("x.x.x.x")]),t._v(";")])])]),t._v(" "),_("h3",{attrs:{id:"_1-3-2-ospf-metric"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-ospf-metric"}},[t._v("#")]),t._v(" 1.3.2 OSPF metric")]),t._v(" "),_("ol",[_("li",[t._v("OSPF的Metric值即是"),_("code",[t._v("COST")]),t._v("值,与带宽有，cost值的计算方法如下：")])]),t._v(" "),_("p",[t._v("Cisco默认情况使用如下公式:")]),t._v(" "),_("p"),_("p",[_("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG",display:"true"}},[_("svg",{staticStyle:{"vertical-align":"-2.172ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"9.886ex",height:"5.208ex",viewBox:"0 -1342 4369.8 2302"}},[_("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"matrix(1 0 0 -1 0 0)"}},[_("g",{attrs:{"data-mml-node":"math"}},[_("g",{attrs:{"data-mml-node":"mfrac"}},[_("g",{attrs:{"data-mml-node":"mn",transform:"translate(1434.9, 676)"}},[_("path",{attrs:{"data-c":"31",d:"M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"}}),_("path",{attrs:{"data-c":"30",d:"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z",transform:"translate(500, 0)"}}),_("path",{attrs:{"data-c":"30",d:"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z",transform:"translate(1000, 0)"}})]),_("g",{attrs:{"data-mml-node":"mrow",transform:"translate(220, -710)"}},[_("g",{attrs:{"data-mml-node":"mo"}},[_("text",{attrs:{"data-variant":"normal",transform:"matrix(1 0 0 -1 0 0)","font-size":"884px","font-family":"serif"}},[t._v("带")]),_("text",{attrs:{"data-variant":"normal",transform:"translate(600, 0) matrix(1 0 0 -1 0 0)","font-size":"884px","font-family":"serif"}},[t._v("宽")])]),_("g",{attrs:{"data-mml-node":"mi",transform:"translate(1477.8, 0)"}},[_("path",{attrs:{"data-c":"4D",d:"M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"}})]),_("g",{attrs:{"data-mml-node":"mi",transform:"translate(2528.8, 0)"}},[_("path",{attrs:{"data-c":"62",d:"M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"}})]),_("g",{attrs:{"data-mml-node":"mi",transform:"translate(2957.8, 0)"}},[_("path",{attrs:{"data-c":"70",d:"M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"}})]),_("g",{attrs:{"data-mml-node":"mi",transform:"translate(3460.8, 0)"}},[_("path",{attrs:{"data-c":"73",d:"M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"}})])]),_("rect",{attrs:{width:"4129.8",height:"60",x:"120",y:"220"}})])])])])])],1),_("p"),t._v(" "),_("p",[_("code",[t._v("100")]),t._v("是默认设置的自动cost带宽参考值，可以在路由器输入如下命令查看路由器的默认参考值：")]),t._v(" "),_("div",{staticClass:"language-shell line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-shell"}},[_("code",[t._v("auto-cost reference-bandwidth "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("  //默认就有\n")])]),t._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[t._v("1")]),_("br")])]),_("p",[t._v("比如语音中的E1线路，其带宽是2.048Mbps，那么根据如上公式，其"),_("code",[t._v("Cost")]),t._v("值为48"),_("code",[t._v("（计算只取整数部分）")])]),t._v(" "),_("p",[t._v("下图展示了部分线路的COST值：")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.bluebaozi.cn/img/v2-290192b18d1c5f8160be0b164335b7ea_1440w.jpg",alt:"img"}})]),t._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[_("p",[t._v("一条"),_("code",[t._v("路由的Cost值")]),t._v("是由"),_("code",[t._v("起源")]),t._v("到"),_("code",[t._v("本路由器")]),t._v("所有"),_("code",[t._v("入向")]),t._v("Cost值的"),_("code",[t._v("累加")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.bluebaozi.cn/img/image-20210712112206218.png",alt:"image-20210712112206218"}})])])]),t._v(" "),_("h3",{attrs:{id:"_1-3-3-ospf的报文"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-3-ospf的报文"}},[t._v("#")]),t._v(" 1.3.3 OSPF的报文")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("Hello")]),t._v(" "),_("th",[t._v("发现"),_("code",[t._v("直连链路上")]),t._v("的OSPF"),_("code",[t._v("邻居")]),t._v(",维护邻居关系")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("DBD（Datebase Description）")]),t._v(" "),_("td",[t._v("链路状态数据库描述报文."),_("br"),t._v("< br />这种保温有两种类型："),_("br"),t._v("1. 空的DD，用于协商Mater/Slave;"),_("br"),t._v("2. 包含了LSD的头部信息，用于描述LSDB的摘要；")])]),t._v(" "),_("tr",[_("td",[t._v("LSR（Link State Request）")]),t._v(" "),_("td",[t._v("链路状态请求报文，用于向OSPF邻居请求链路状态信息")])]),t._v(" "),_("tr",[_("td",[t._v("LSU")]),t._v(" "),_("td",[t._v("链路状态更新报文，该报文包含完整的链路状态信息")])]),t._v(" "),_("tr",[_("td",[t._v("LSAck (Link State Ack)")]),t._v(" "),_("td",[t._v("用于确保OSPF报文的可靠传输；")])])])]),t._v(" "),_("h3",{attrs:{id:"_1-3-4-ospf的三张表"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-4-ospf的三张表"}},[t._v("#")]),t._v(" 1.3.4 OSPF的三张表")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("邻居表（Neighbor Table）")]),t._v(" "),_("th",[t._v("路由器要形成邻居关系之前需要建立"),_("code",[t._v("邻接Adjancency")]),t._v("关系;"),_("br"),t._v("邻居表存储了OSPF的"),_("code",[t._v("邻居状态")]),t._v("和关于该邻居的其他数据。")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("拓扑数据库表 (Link-state Database)")]),t._v(" "),_("td",[t._v("OSPF用LSA（Link State Advertisement 链路状态通告）来描述网络拓补信息；"),_("br"),t._v("LSDB存储这路由器产生或者收到LSA信息")])]),t._v(" "),_("tr",[_("td",[t._v("OSPF路由表 (OSPF Routing Table)")]),t._v(" "),_("td",[t._v("基于LSDB运行SPF算法，以自己为根，算出到每个目的地的最短路径的路由加入到路由表中")])])])])])}),[],!1,null,null,null);v.default=e.exports}}]);