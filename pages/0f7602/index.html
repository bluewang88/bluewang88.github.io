<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OSPFv2的邻接关系建立过程 | 二十&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/bluebaozi-favicon.ico">
    <script data-ad-client="ca-pub-7517431412685010" async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <meta name="description" content="一个想学各种技术的攻城狮">
    <meta name="keywords" content="voice,个人技术博客,cisco,思科,avaya,亚美亚,uccx,cucm,callcenter,呼叫中心,python,js,Django,collaboration,vue,python,cummunication,callmanager,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="code-neRQj6JIlv">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="preload" href="/assets/css/0.styles.fea45285.css" as="style"><link rel="preload" href="/assets/js/app.3ddeaebb.js" as="script"><link rel="preload" href="/assets/js/2.e69e7ad3.js" as="script"><link rel="preload" href="/assets/js/12.5944f797.js" as="script"><link rel="prefetch" href="/assets/js/10.7485dac7.js"><link rel="prefetch" href="/assets/js/11.ad29554b.js"><link rel="prefetch" href="/assets/js/13.0ba430d9.js"><link rel="prefetch" href="/assets/js/14.bba2ab91.js"><link rel="prefetch" href="/assets/js/15.4cd7c7a8.js"><link rel="prefetch" href="/assets/js/16.94f4fab2.js"><link rel="prefetch" href="/assets/js/17.625c8358.js"><link rel="prefetch" href="/assets/js/18.4aaab02e.js"><link rel="prefetch" href="/assets/js/19.80f75ba9.js"><link rel="prefetch" href="/assets/js/20.6591b83a.js"><link rel="prefetch" href="/assets/js/21.2220b354.js"><link rel="prefetch" href="/assets/js/22.b8f76571.js"><link rel="prefetch" href="/assets/js/23.3c62c337.js"><link rel="prefetch" href="/assets/js/24.e5ad9c73.js"><link rel="prefetch" href="/assets/js/25.2052ed57.js"><link rel="prefetch" href="/assets/js/3.9efa95c3.js"><link rel="prefetch" href="/assets/js/4.53b9e287.js"><link rel="prefetch" href="/assets/js/5.eab20f75.js"><link rel="prefetch" href="/assets/js/6.121a8a68.js"><link rel="prefetch" href="/assets/js/7.b6eaa670.js"><link rel="prefetch" href="/assets/js/8.55b01854.js"><link rel="prefetch" href="/assets/js/9.71de7a81.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fea45285.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/bluebaozi-logo.png" alt="二十's blog" class="logo"> <span class="site-name can-hide">二十's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/net_voice/" class="nav-link">网络和语音</a></div><div class="nav-item"><a href="/ops/" class="nav-link">运维</a></div><div class="nav-item"><a href="/cloud_Virtualization/" class="nav-link">云计算和虚拟化</a></div><div class="nav-item"><a href="/coding/" class="nav-link">编程</a></div><div class="nav-item"><a href="/Security/" class="nav-link">安全</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/categories/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6.html" class="nav-link">收藏</a></div> <a href="https://github.com/bluewang88/bluewang88.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="http://markdown-bluebaozi.oss-cn-shanghai.aliyuncs.com/img/image-20210706232943610.png"> <div class="blogger-info"><h3>Alastair Wang</h3> <span>不断练习的攻城狮</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/net_voice/" class="nav-link">网络和语音</a></div><div class="nav-item"><a href="/ops/" class="nav-link">运维</a></div><div class="nav-item"><a href="/cloud_Virtualization/" class="nav-link">云计算和虚拟化</a></div><div class="nav-item"><a href="/coding/" class="nav-link">编程</a></div><div class="nav-item"><a href="/Security/" class="nav-link">安全</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="/more/" class="nav-link">更多</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/categories/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6.html" class="nav-link">收藏</a></div> <a href="https://github.com/bluewang88/bluewang88.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b6239c/" class="sidebar-link">OSPFv2的介绍</a></li><li><a href="/pages/0f7602/" aria-current="page" class="active sidebar-link">OSPFv2的邻接关系建立过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0f7602/#dr-bdr的选举" class="sidebar-link">DR/BDR的选举</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0f7602/#dr-bdr的含义" class="sidebar-link">DR/BDR的含义</a></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#dr-bdr的选举规则" class="sidebar-link">DR/BDR的选举规则</a></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#一个ospf区域中多个dr-bdr" class="sidebar-link">一个OSPF区域中多个DR/BDR</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#邻接关系建立过程" class="sidebar-link">邻接关系建立过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/0f7602/#实验拓扑" class="sidebar-link">实验拓扑</a></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#接口开启-ospf状态改为-init" class="sidebar-link">接口开启，OSPF状态改为 init</a></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#收到hello包-建立邻居关系-状态改为two-way" class="sidebar-link">收到Hello包，建立邻居关系，状态改为Two Way</a></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#dead-interval超时-路由器开始选举dr-bdr" class="sidebar-link">Dead Interval超时，路由器开始选举DR/BDR</a></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#进入ex-start状态-进行主从协商" class="sidebar-link">进入ex-start状态，进行主从协商</a></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#进入ex-change状态-交换lsa" class="sidebar-link">进入ex-change状态，交换LSA</a></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#lsr-lsu-同步完成lsdb后-建立邻接关系-状态变为full" class="sidebar-link">LSR/LSU 同步完成LSDB后，建立邻接关系，状态变为FULL</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/0f7602/#配置ospf" class="sidebar-link">配置OSPF</a></li></ul></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/categories/?category=%E7%BD%91%E7%BB%9C%E5%92%8C%E8%AF%AD%E9%9F%B3" title="分类" data-v-1cd794fe>网络和语音</a></li> <li data-v-1cd794fe><a href="/categories/?category=%E5%9F%BA%E7%A1%80%E7%BD%91%E7%BB%9C" title="分类" data-v-1cd794fe>基础网络</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/bluewang88" target="_blank" title="作者" class="beLink" data-v-1cd794fe>wangwei</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-07-19</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          OSPFv2的邻接关系建立过程
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="ospfv2的邻接关系建立过程"><a href="#ospfv2的邻接关系建立过程" class="header-anchor">#</a> OSPFv2的邻接关系建立过程</h1> <h2 id="dr-bdr的选举"><a href="#dr-bdr的选举" class="header-anchor">#</a> DR/BDR的选举</h2> <h3 id="dr-bdr的含义"><a href="#dr-bdr的含义" class="header-anchor">#</a> DR/BDR的含义</h3> <ol><li>DR：<code>Designated Router</code>指定路由器，在OSPF域中，每个路由器都<code>只</code>需要和DR/BDR建立邻居关系（这样子就避免了OSPF域中每个路由器之间都要相互建立邻居关系【full mesh】，节省了开销），这样子DR会拥有所有的LSA信息，并且DR将LSA信息转发给每个建立邻居关系的路由器；</li> <li>BDR：<code>Backup Designated Router</code>备份指定路由器，作为DR的备份，在DR失效后由BDR代替其功能；</li></ol> <blockquote><p>DR/BDR是指路由器的一个活动接口，并非是整台路由器。</p></blockquote> <h3 id="dr-bdr的选举规则"><a href="#dr-bdr的选举规则" class="header-anchor">#</a> DR/BDR的选举规则</h3> <blockquote><p>DR/BDR的选举是一种状态激发的动作，在<code>Wait Time</code>超时后，会触发DR/BDR的选举</p></blockquote> <ol><li><p>OSPF priority<code>最高</code>的是DR；（默认priority是1，可以通过<code>ip ospf priority x</code>来更改））（priority数值越大，优先级越高）</p></li> <li><p>如果priority相同，那么<code>RID最大</code>的选举为DR；</p></li> <li><p>BDR是优先级仅次于DR的路由器；</p></li> <li><p>如果一个MA网络中原来的DR失效，那么BDR代替成为DR，这时还需要再选举一个BDR，BDR选举完成后，如果原来的DR恢复，也不会抢占，会成为网络中的DR或者DROther,这样有利于网络的稳定性；(DR/BDR不会抢占，如果需要进行一次抢占，那么需要输入<code>clear ip osfp process</code>清理ospf进程)</p> <p>（OSPF启动后，如果40s（Wait timer）内没有新设备接入，那么久会开始DR/BDR的选举）；</p> <p>可以在接口下，通过如下命令可以看到这个计时器：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>R1<span class="token comment">#show ip ospf interface ethernet 0/0</span>
Ethernet0/0 is up, line protocol is up
  Internet Address <span class="token number">192.168</span>.1.1/24, Area <span class="token number">0</span>, Attached via Network Statement
  Process ID <span class="token number">1</span>, Router ID <span class="token number">1.1</span>.1.1, Network Type BROADCAST, Cost: <span class="token number">10</span>
  Topology-MTID    Cost    Disabled    Shutdown      Topology Name
        <span class="token number">0</span>           <span class="token number">10</span>        no          no            Base
  Transmit Delay is <span class="token number">1</span> sec, State DR, Priority <span class="token number">1</span>
  Designated Router <span class="token punctuation">(</span>ID<span class="token punctuation">)</span> <span class="token number">1.1</span>.1.1, Interface address <span class="token number">192.168</span>.1.1
  Backup Designated router <span class="token punctuation">(</span>ID<span class="token punctuation">)</span> <span class="token number">192.168</span>.1.2, Interface address <span class="token number">192.168</span>.1.2
  Timer intervals configured, <span class="token variable"><span class="token variable">`</span>Hello <span class="token number">10</span>, Dead <span class="token number">40</span>, Wait <span class="token number">40</span><span class="token variable">`</span></span>, Retransmit <span class="token number">5</span>
    oob-resync <span class="token function">timeout</span> <span class="token number">40</span>
    Hello due <span class="token keyword">in</span> 00:00:02
  Supports Link-local Signaling <span class="token punctuation">(</span>LLS<span class="token punctuation">)</span>
  Cisco NSF helper support enabled
  IETF NSF helper support enabled
  Index <span class="token number">1</span>/1, flood queue length <span class="token number">0</span>
  Next 0x0<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>/0x0<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  Last flood scan length is <span class="token number">0</span>, maximum is <span class="token number">1</span>
  Last flood scan <span class="token function">time</span> is <span class="token number">0</span> msec, maximum is <span class="token number">0</span> msec
  Neighbor Count is <span class="token number">1</span>, Adjacent neighbor count is <span class="token number">1</span>
    Adjacent with neighbor <span class="token number">192.168</span>.1.2  <span class="token punctuation">(</span>Backup Designated Router<span class="token punctuation">)</span>
  Suppress hello <span class="token keyword">for</span> <span class="token number">0</span> neighbor<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li></ol> <blockquote><p><strong>注意</strong></p> <p>如果设置了priority 的值为0，那么该路由器不会被选择为DR/BDR，他会成为DROther(成员路由器)</p> <p>MA网络：多路访问网络（multi-access），比如一个以太网就是一个典型的<code>广播多路访问BMA</code>网络，而帧中继中的点到多点网络就是<code>非广播多路访问NBMA</code>网络</p></blockquote> <h3 id="一个ospf区域中多个dr-bdr"><a href="#一个ospf区域中多个dr-bdr" class="header-anchor">#</a> 一个OSPF区域中多个DR/BDR</h3> <p>上面了解了DR/BDR的选举规则后，这里还有比较容易混淆的一点是：</p> <p><strong><u>DR/BDR的选举<code>并不是</code>在一个区域内所有OSPF路由器都参与选举，<code>而是</code>在<code>同一个MA网络中</code>，如果是在以太网就是在同一个广播域中选举DR/BDR</u></strong></p> <p>举例如下：</p> <p><img src="https://pic.bluebaozi.cn/img/ospf-drbdr.png" alt="ospf-drbdr"></p> <p>这其中路由器<code>R8</code>上就可以看到两个DR/BDR，虽然他们是一个OSPF区域，但是出于不同的广播域。</p> <p>R6的f0/0,R8的f/0,R9de f0/0,SW2构成了一个广播域，正常情况下，在这个MA网络中DR为</p> <h2 id="邻接关系建立过程"><a href="#邻接关系建立过程" class="header-anchor">#</a> 邻接关系建立过程</h2> <blockquote><p>两台路由器之间建立邻接关系可以祖鲁额的分为两个阶段：1. 邻居关系建立阶段；2.邻接关系建立阶段。<code>邻居关系</code>是<code>邻接关系</code>建立的前提条件。</p></blockquote> <h3 id="实验拓扑"><a href="#实验拓扑" class="header-anchor">#</a> 实验拓扑</h3> <p>之后论述OSPF邻接关系建立过程的实验拓扑图如下：</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210714160206239.png" alt="image-20210714160206239"></p> <p>R1和R2已经进行了基础配置：</p> <p>R1:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>int lo
	<span class="token function">ip</span> <span class="token function">add</span> <span class="token number">1.1</span>.1.1 <span class="token number">255.255</span>.255.0
int e0/0
	<span class="token function">ip</span> <span class="token function">add</span> <span class="token number">192.168</span>.1.1 <span class="token number">255.255</span>.255.0
router ospf <span class="token number">1</span>
	router-id <span class="token number">1.1</span>.1.1
	network <span class="token number">192.168</span>.1.0 <span class="token number">0.0</span>.0.255 area <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>R2:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>int lo
	<span class="token function">ip</span> <span class="token function">add</span> <span class="token number">2.2</span>.2.2 <span class="token number">255.255</span>.255.0
int e0/0
	<span class="token function">ip</span> <span class="token function">add</span> <span class="token number">192.168</span>.1.2 <span class="token number">255.255</span>.255.0
router ospf <span class="token number">1</span>
	router-id <span class="token number">2.2</span>.2.2
	network <span class="token number">192.168</span>.1.0 <span class="token number">0.0</span>.0.255 area <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>R1和R2这时并<code>没有</code>开启<code>e0/0</code>接口，这时两台路由器并不会发送<code>HELLO</code>报文</p> <p>如果要观察路由器建立OSPF邻接关系的过程，那么输入如下<code>DEBUG命令</code>：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>debug ip ospf event  <span class="token operator">//</span>查看ospf的所有事件
debug ip ospf adj    <span class="token operator">//</span> 查看建立邻接关系的交互信息
debug ip ospf hello  <span class="token operator">//</span>查看hello报文的交互信息
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="接口开启-ospf状态改为-init"><a href="#接口开启-ospf状态改为-init" class="header-anchor">#</a> 接口开启，OSPF状态改为 <code>init</code></h3> <blockquote><p>路由器接口开启之前，ospf的转台处于<code>DOWN</code>的状态；</p> <p>路由器接口开启后，发送<code>Hello</code>包，但没有收到<code>Hello</code>包时，状态为<code>Attempt</code>；</p> <p>路由器接口开启后收到<code>Hello</code>包，状态改为<code>Init</code>；</p></blockquote> <p>这时开启接口，会看到如下LOG日志，可以看到E0/0接口一旦起来，他们接口上建立邻接关系的<code>进程</code>也立马启动，</p> <p>可以看到E0/0接口开始发送HELLO报文到组播地址<code>224.0.0.5</code>去尝试发现邻居</p> <p>并可以看到E0/0接口的<code>WAIT Timer</code>计时器开始计时，</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210714162600793.png" alt="image-20210714162600793"></p> <p>R1的e0/0接口的抓包：</p> <p>通过抓包分析，可以看到37min42s的时候，确实抓到一个从192.168.1.1发到224.0.0.5的一个<code>Hello</code>包,</p> <p>从这个packet可以看到 RID、Hello Interval 、接口的Priority（Router Priority），Router Dead Interval的值；</p> <p>同时也可以看到这时的OSPF的DR/BDR都显示为<code>0.0.0.0</code>，说明这时还未选举DR/BDR</p> <blockquote><p>需要说明的是 Hello Interval、Router Dead Intereval、Wait Timer之间的关系：</p> <p><code>Wait Timer = Router Dead Interval = Hello Interval * 4</code></p> <p>通过在接口下输入<code>ip ospf hello-interval x</code> <code>x</code>为修改后的时间间隔，单位为s;</p> <p>输入<code>show ip ospf interface x</code> <code>x</code>为接口，可以查看这三个参数的具体值</p></blockquote> <p><img src="https://pic.bluebaozi.cn/img/image-20210714163937942.png" alt="image-20210714163937942"></p> <p>与此同时开启R2的e/0/0接口，可以看到和R1相同的信息：</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210714170807973.png" alt="image-20210714170807973"></p> <p>查看R2的e0/0接口的抓包，同样可以看到R2发出的<code>Hello</code>包</p> <img src="https://pic.bluebaozi.cn/img/image-20210714163740895.png" alt="image-20210714163740895" style="zoom:115%;"> <blockquote><p>这里还需要注意的一点是，在起始状态，也就是R1和R2没有收到任何<code>hello</code>信息时，他们发送的<code>HELLO</code>包中的<code>Active Neighbor</code>字段没有任何值的（抓包中不会显示Active Neighbor）字段；</p> <p><code>Active Neighbor</code>字段本来用来存储每个接口上发现的邻居信息；</p></blockquote> <h3 id="收到hello包-建立邻居关系-状态改为two-way"><a href="#收到hello包-建立邻居关系-状态改为two-way" class="header-anchor">#</a> 收到Hello包，建立邻居关系，状态改为<code>Two Way</code></h3> <blockquote><p><code>Two Way</code>状态建立的一个充分条件是：收到的Hello包中，<code>Active Neighbor</code>的值是自己的<code>RID</code>，那么本地OSPF接口状态立即变为<code>Two Way</code>状态，<code>Two Way</code>状态建立表明成功建立<code>邻居关系</code></p></blockquote> <p>R2先收到了R1的<code>Hello</code>包，从LOG日志可以看到</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715001751047.png" alt="image-20210715001751047"></p> <p>从抓包日志可以看到这个包没有设置DR/BDR</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715002118557.png" alt="image-20210715002118557"></p> <p>R2收到R1的 Hello包后，将<code>Hello</code>包中的<code>RID</code>记录在自己的接口数据结构中，并且将R1的状态视为<code>Init</code>，这时R2发出的<code>Hello</code>包中包含的<code>Active Neighbor</code>字段就是<code>1.1.1.1</code>(R1的<code>RID</code>)，这时R2还没有变为<code>Two Way</code>状态，因为还没有到<code>Active Neighbor</code>是自己<code>RID</code>的<code>Hello</code>包</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715003140058.png" alt="image-20210715003140058"></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715002829823.png" alt="image-20210715002829823"></p> <p>然后，R1收到了这个<code>Active Neighbor</code>字段为自己<code>RID</code>的<code>Hello</code>数据包，那么R1立马变成了<code>Two Way</code>的状态</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715003104480.png" alt="image-20210715003104480"></p> <p>之后，R1发单播给R2<code>Hello</code>包，这个Hello包中的<code>Active Neighbor</code>为R2的<code>RID</code></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715003925594.png" alt="image-20210715003925594"></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715004009373.png" alt="image-20210715004009373"></p> <p>这时，R2收到了R1发给自己的单播Hello包，并且<code>Active Neighbor</code>的值为R2自己的<code>RID</code>,这时R2状态立马变成<code>Two Way</code>（这里是状态特指R2和R1之间的邻居关系变为<code>Two Way</code>状态，因为R2可能有多个邻居关系）</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715004324368.png" alt="image-20210715004324368"></p> <p>在R1和R2都等待40s的超时时间后，各自开始根据自己接口数据结构中收集到的<code>Neighbor</code>,开始选举DR/BDR</p> <p>R1：</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715004742311.png" alt="image-20210715004742311"></p> <p>R2:</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715004658604.png" alt="image-20210715004658604"></p> <blockquote><p>完成以上的全部过程后，R1和R2之间的<code>邻居关系</code>建立成功。</p></blockquote> <h3 id="dead-interval超时-路由器开始选举dr-bdr"><a href="#dead-interval超时-路由器开始选举dr-bdr" class="header-anchor">#</a> Dead Interval超时，路由器开始选举DR/BDR</h3> <blockquote><p><em>选举DR/BDR和是否已经建立</em>*<u>邻居关系</u>*<em>没有直接联系</em>，它主要是一个接口状态的超时任务，只要接口的<code>Wait Timer</code>超时后就会进行<code>DR/BDR</code>的选举</p></blockquote> <p><img src="https://pic.bluebaozi.cn/img/image-20210715105013673.png" alt="image-20210715105013673"></p> <p>DR/BDR的选举遵循如下规则：</p> <ol><li>接口优先级大的，优先；</li> <li>RID大的优先；</li></ol> <h3 id="进入ex-start状态-进行主从协商"><a href="#进入ex-start状态-进行主从协商" class="header-anchor">#</a> 进入<code>ex-start</code>状态，进行主从协商</h3> <blockquote><p>一个路由器如果需要发送<code>DBD</code>报文协商<code>Master\Salver</code>,那么需要等待<code>Wait Timer</code>超时后选举完成DR/BDR路由器后，才会发送<code>DBD</code>协商主从关系；</p> <p>路由器发出协商主从关系的<code>DBD</code>报文中，是不包含<code>LSA</code>信息的；</p></blockquote> <p>R1:从R1的LOG日志可以看到，在<code>Wait Timer</code>超时之前R1不会发送DBD信息（即使受到了R2的DBD报文，也不会回复）；</p> <p>但是当R1一旦<code>Wait Timer</code>超时后，R1立马发送<code>DBD</code>报文；</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715112505383.png" alt="image-20210715112505383"></p> <p>并且可以从抓包中看到这个报文不包含LSA信息,并且<code>I,M,MS</code>的字段都是<code>1</code></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715131349453.png" alt="image-20210715131349453"></p> <p>R2：从R2的log日志可以看到，从R2完成了DR/BDR的选举之后，就开始向R1发送DBD报文了，但一直没有得到回复，一直等到R1<code>Wait Timer</code>超时过后并完成了DR/BDR的选举之后，才收到R1的DBD消息。</p> <p>可以从如下R2的log日志可以看到R2在21min41.862s收到R1的DBD报文；</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715112126657.png" alt="image-20210715112126657"></p> <p>同时也可以看到R2在21min40.975s发送的报文中，<code>I,M,MS</code>的字段都是<code>1</code></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715133725888.png" alt="image-20210715133725888"></p> <blockquote><p><code>I,M,MS</code>的字段的含义如下：</p> <p><code>I</code>：在<code>Exstart</code>, Master/Salver的协商阶段，该字段都是置<code>1</code></p> <p><code>M</code>：<code>1</code>表示后面还有DD报文,<code>0</code>表示没有报文了</p> <p><code>MS</code>：<code>1</code>表示主，<code>0</code>表示从</p> <p>第一个DD报文两边都认为自己是主，所以三个字段都只置为<code>1</code></p></blockquote> <p>通过观察R1的log日志，发现R1在21min41.862s收到R2的<code>DBD</code>报文后，根据收到的报文中RID的信息，<strong><u>RID<code>大</code>的为<code>Master</code>，<code>小</code>的为<code>Salver</code></u></strong></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715142955292.png" alt="image-20210715142955292"></p> <p>从抓包日志可以看到R1发出的</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715143335908.png" alt="image-20210715143335908"></p> <p>R2:</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715143109540.png" alt="image-20210715143109540"></p> <p>在R2接口上抓包可以看到收到了R1发过来的，包含了声明R1是<code>Salve</code>·的DBD报文，R2收到报文后，立马规定了自己是<code>Master</code>的角色，并且由R1的<code>DBD</code>报文中<code>I</code>的字段设置为<code>0</code>，知道了<code>ex-start</code>状态已经过去，由此进去下一个状态<code>ex-change</code></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715151925489.png" alt="image-20210715151925489"></p> <h3 id="进入ex-change状态-交换lsa"><a href="#进入ex-change状态-交换lsa" class="header-anchor">#</a> 进入<code>ex-change</code>状态，交换LSA</h3> <blockquote><p>当收到的DBD报文中，<code>I</code>字段为<code>0</code>时，将邻居状态变成<code>ex-change</code></p></blockquote> <p>R1发送给R2的DBD报文中，<code>I</code>字段为<code>0</code>，并且<code>MS</code>字段为<code>0</code>表明自己<code>Salver</code>的角色，同时可以看到，这个<code>DBD</code>报文中含有<code>LSA</code>信息，并且<code>M</code>字段设置为<code>1</code>表明还有DBD报文需要发送，一般<code>M</code>都是<code>0</code>；</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715155633143.png" alt="image-20210715155633143"></p> <p>R2收到R1的包含LSA的DBD报文，同时也发送给R1z自己的包含LSA信息的报文</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715161109958.png" alt="image-20210715161109958"></p> <p>R1如果需要进一步获取LSA的详细情况，会给R2发送<code>LSR</code>信息,并R1上，将R2的邻居状态变成<code>Loading</code></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715162452828.png" alt="image-20210715162452828"></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715163126691.png" alt="image-20210715163126691"></p> <p>同时R2收到R1的LSR请求后，会发送LSU信息给R1,包含更加详尽的LSA信息<u><strong>（只有在<code>LSU</code>信息中才可以看到完整的LSA信息）</strong></u></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715163038090.png" alt="image-20210715163038090"></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715163230552.png" alt="image-20210715163230552"></p> <h3 id="lsr-lsu-同步完成lsdb后-建立邻接关系-状态变为full"><a href="#lsr-lsu-同步完成lsdb后-建立邻接关系-状态变为full" class="header-anchor">#</a> LSR/LSU 同步完成LSDB后，建立邻接关系，状态变为<code>FULL</code></h3> <p>R2收到所有的LSU信息后，放入自己的LSDB中，并给R1发送一个<code>LSACK</code></p> <p>如果R2的所有LSR请求，都得到LSU更新后，会在R2上将邻居R1的状态置为<code>FULL</code>(可能这时候R1上对应R2的邻居状态还<code>不是FULL</code>)</p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715164145092.png" alt="image-20210715164145092"></p> <p><img src="https://pic.bluebaozi.cn/img/image-20210715164559035.png" alt="image-20210715164559035"></p> <p>R1同理，这里就不在赘述了。</p> <h2 id="配置ospf"><a href="#配置ospf" class="header-anchor">#</a> 配置OSPF</h2> <ol><li>配置接口地址</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>R1<span class="token comment">#conf t</span>
Enter configuration commands, one per line.  End with CNTL/Z.
R1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int e0/0</span>
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip add 192.168.1.1 255.255.255.0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>配置环回口地址</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>R1<span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token comment">#int lo0</span>
*Jul <span class="token number">13</span> 07:07:22.851: %LINEPROTO-5-UPDOWN: Line protocol on Interface Loopback0,                                         changed state to up
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#ip add 1.1.1.1 255.255.255.0</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="3"><li>配置OSPF进程</li></ol> <p>OSPF配置模板如下：(建议手动配置RID,以loopback接口为佳)</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>router ospf <span class="token punctuation">[</span>ospf进程号<span class="token punctuation">]</span>
    router-id <span class="token punctuation">[</span>ospf的RID<span class="token punctuation">]</span>
	network <span class="token punctuation">[</span>网络地址<span class="token punctuation">]</span> <span class="token punctuation">[</span>反掩码<span class="token punctuation">]</span> area <span class="token punctuation">[</span>区域地址<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p><code>process-id 进程号</code>:</p> <p>OSPF支持多进程，为不同的的业务可以分配不同的进程，用进程号区分。但是进程号是本地概念，不会影响其他路由器的进程号选择，所以不同路由器之间的进程号相同也没有影响。而且，不同路由器之间不同进程的OSPF也可以进行报文交互。</p> <p><code>router-id 路由器ID</code>:</p> <p>需要保证在OSPF全网中唯一。</p></blockquote> <p>配置R1路由器的ospf的script如下:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>router ospf <span class="token number">1</span>
	router-id <span class="token number">1.1</span>.1.1
	network <span class="token number">192.168</span>.1.0 <span class="token number">0.0</span>.0.255 area <span class="token number">0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>以此类推，将所有路由器配置完成。</p> <p>开启debug可以查看OSPF邻居建立的交互过程：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>debug <span class="token function">ip</span> ospf events 
debug <span class="token function">ip</span> ospf hello  //查看hello包的过程
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>R1</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>*Jul <span class="token number">13</span> 07:49:57.662: OSPF EVENT Et0/0: Route adjust
*Jul <span class="token number">13</span> 07:49:57.662: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:49:57.662: OSPF-1 EVENT: Config: network <span class="token number">192.168</span>.1.0 <span class="token number">255.255</span>.255.0 area <span class="token number">0</span>
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:07.248: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:16.740: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:25.927: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:35.028: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:44.490: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:46.349: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:50:46.349: OSPF-1 HELLO Et0/0: Send immediate hello to nbr <span class="token number">192.168</span>.1.2, src address <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:50:46.349: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:54.240: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:50:54.241: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
R1<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:54.242: %OSPF-5-ADJCHG: Process <span class="token number">1</span>, Nbr <span class="token number">192.168</span>.1.2 on Ethernet0/0 from LOADING to FULL, Loading Done
*Jul <span class="token number">13</span> 07:50:56.092: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:51:04.231: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:05.871: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:51:14.123: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:15.096: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:51:23.498: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:24.508: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:51:32.943: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:33.961: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:51:42.756: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:43.008: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:51:52.127: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:52.645: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:52:01.456: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:52:02.267: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:52:11.043: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:52:11.679: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:52:20.560: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:52:21.653: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">192.168</span>.1.2 area <span class="token number">0</span> <span class="token number">192.168</span>.1.2

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>R2:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>*Jul <span class="token number">13</span> 07:50:46.348: OSPF EVENT Et0/0: Route adjust
*Jul <span class="token number">13</span> 07:50:46.348: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
*Jul <span class="token number">13</span> 07:50:46.349: OSPF-1 EVENT: Config: network <span class="token number">192.168</span>.1.0 <span class="token number">255.255</span>.255.0 area <span class="token number">0</span>
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:54.240: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:50:54.240: OSPF-1 HELLO Et0/0: Send immediate hello to nbr <span class="token number">1.1</span>.1.1, src address <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:50:54.240: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">192.168</span>.1.1 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:54.243: %OSPF-5-ADJCHG: Process <span class="token number">1</span>, Nbr <span class="token number">1.1</span>.1.1 on Ethernet0/0 from LOADING to FULL, Loading Done
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:50:56.091: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:51:04.231: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:51:05.870: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:51:14.123: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:15.095: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:51:23.499: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:24.507: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:51:32.944: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:33.961: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:51:42.756: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:43.007: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:51:52.127: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:51:52.644: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:52:01.456: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:52:02.266: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2
R2<span class="token punctuation">(</span>config-if<span class="token punctuation">)</span><span class="token comment">#</span>
*Jul <span class="token number">13</span> 07:52:11.044: OSPF-1 HELLO Et0/0: Rcv hello from <span class="token number">1.1</span>.1.1 area <span class="token number">0</span> <span class="token number">192.168</span>.1.1
*Jul <span class="token number">13</span> 07:52:11.679: OSPF-1 HELLO Et0/0: Send hello to <span class="token number">224.0</span>.0.5 area <span class="token number">0</span> from <span class="token number">192.168</span>.1.2

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>可以查看R1 的 ospf的邻居：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>R1<span class="token comment">#show ip ospf neighbor</span>

Neighbor ID     Pri   State           Dead Time   Address         Interface
<span class="token number">2.2</span>.2.2           <span class="token number">1</span>   FULL/DR        00:00:31    <span class="token number">192.168</span>.1.2     Ethernet0/0

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>查看R2的OSPF邻居</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>R2<span class="token comment">#show ip ospf neighbor</span>

Neighbor ID     Pri   State           Dead Time   Address         Interface
<span class="token number">1.1</span>.1.1           <span class="token number">1</span>   FULL/BDR         00:00:31    <span class="token number">192.168</span>.1.1     Ethernet0/0

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看到在R1和R2之间的DR/BDR的选举中，R2是作为DR（Designated Router指定路由器）</p> <ol start="4"><li><p>将路由宣告进入OSPF网络。</p> <p>有两种方法：</p> <p>a. 将接口宣告到OSPF中</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token builtin">int</span> xxx
 ip ospf <span class="token operator">&lt;</span>ospf 进程号<span class="token operator">&gt;</span> area <span class="token operator">&lt;</span>区域ID<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>b.使用<code>network</code>直接宣告</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>router ospf <span class="token punctuation">[</span>ospf进程号<span class="token punctuation">]</span>
    router<span class="token operator">-</span><span class="token builtin">id</span> <span class="token punctuation">[</span>ospf的RID<span class="token punctuation">]</span>
	network <span class="token punctuation">[</span>网络地址<span class="token punctuation">]</span> <span class="token punctuation">[</span>反掩码<span class="token punctuation">]</span> area <span class="token punctuation">[</span>区域地址<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/bluewang88/bluewang88.github.io/edit/master/docs/01.网络和语音/01.基础网络/02.OSPFv2的邻接关系建立过程.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=OSPF" title="标签">#OSPF</a><a href="/tags/?tag=%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2" title="标签">#路由交换</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/07/21, 16:40:22</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/b6239c/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">OSPFv2的介绍</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b6239c/" class="prev">OSPFv2的介绍</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/b3a91c/"><div>Git简易教程</div></a> <span>07-13</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/851ba5/"><div>Github Action 自动部署脚本出现无法识别报错</div></a> <span>07-13</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/b6239c/"><div>OSPFv2的介绍</div></a> <span>07-12</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:846087453@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/bluewang88" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://c.y.qq.com/base/fcgi-bin/u?__=cG9avd44" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2021
    <span>Alastair Wang | <a href="https://github.com/bluewang88/Blogs/blob/78db3ddf282be89112e24cb18dda2c00f52ce142/LICENSE.md" target="_blank">MIT License</a> | <a rel="nofollow " target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=18057030">沪ICP备2021019387号-1</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><div></div></div></div>
    <script src="/assets/js/app.3ddeaebb.js" defer></script><script src="/assets/js/2.e69e7ad3.js" defer></script><script src="/assets/js/12.5944f797.js" defer></script>
  </body>
</html>